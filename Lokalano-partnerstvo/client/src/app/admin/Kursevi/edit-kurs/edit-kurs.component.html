<section *ngIf="kurs" class="kurs-edit" style="margin-bottom: 100px;">
  <div class="mt-5 pt-5">
    <button routerLink="/dashboard/kurs-dashboard" style="background-color:transparent;" class="btn btn-light"><i class="fa fa-lg fa-arrow-left text-secondary"></i></button>
  </div>
  <div class="container">
    <div class="row">
      <h1 class="mb-5">{{title}}</h1>
      <div class="col-lg-12">
        <form
          #kursForm="ngForm"
          (ngSubmit)="onSubmit(kursForm.valid && kursForm.value)"
        >
          <div class="col-lg-6">
            <div class="form-row">
              <div class="form-group">
                <label for="kategorija">Kategorija</label>
                <select
                  *ngIf="novi === false"
                  id="kategorija"
                  class="form-control"
                  name="kategorijaId"
                  [(ngModel)]="selectedObj"
                  required
                >
                  <option
                    *ngFor="let kategorija of kurseviKategorije"
                    [selected]="kurs.kursKategorijaId === kategorija.id"
                    [ngValue]="kategorija.id"
                  >
                    {{ kategorija.naziv }}
                  </option>
                </select>

                <select
                  *ngIf="novi == true"
                  id="kategorija"
                  class="form-control"
                  name="kategorijaId"
                  [(ngModel)]="selectedObj"
                  required
                >
                  <option selected value="Odaberite kategoriju">
                    Odaberi kategoriju
                  </option>

                  <option
                    *ngFor="let kategorija of kurseviKategorije"
                    [ngValue]="kategorija.id"
                  >
                    {{ kategorija.naziv }}
                  </option>
                </select>
              </div>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label for="naziv">Naziv</label>
                <input
                  [ngClass]="{
                    'is-invalid':
                      naziv.invalid && (naziv.dirty || naziv.touched)
                  }"
                  required
                  type="text"
                  class="form-control"
                  id="naziv"
                  placeholder="Naziv"
                  name="naziv"
                  #naziv="ngModel"
                  [(ngModel)]="kurs.naziv"
                />
                <div
                  *ngIf="naziv.invalid && (naziv.dirty || naziv.touched)"
                  class="invalid-feedback"
                >
                  <div *ngIf="naziv.errors.required">
                    Naziv kursa je obavezan
                  </div>
                </div>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="datumObjave">Datum objave</label>
                <input
                  [ngClass]="{
                    'is-invalid':
                      datumObjave.invalid &&
                      (datumObjave.dirty || datumObjave.touched)
                  }"
                  required
                  type="date"
                  class="form-control"
                  id="datumObjave"
                  name="datumObjave"
                  #datumObjave="ngModel"
                  [(ngModel)]="kurs.datumObjave"
                />
                <div
                  *ngIf="
                    datumObjave.invalid &&
                    (datumObjave.dirty || datumObjave.touched)
                  "
                  class="invalid-feedback"
                >
                  <div *ngIf="datumObjave.errors.required">
                    Datum objave kursa je obavezan
                  </div>
                </div>
              </div>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label for="datumPocetka">Datum početka kursa</label>
                <input
                  [ngClass]="{
                    'is-invalid':
                      datumPocetka.invalid &&
                      (datumPocetka.dirty || datumPocetka.touched)
                  }"
                  required
                  type="date"
                  class="form-control"
                  id="datumPocetka"
                  name="datumPocetka"
                  #datumPocetka="ngModel"
                  [(ngModel)]="kurs.datumPocetka"
                />
                <div
                  *ngIf="
                    datumPocetka.invalid &&
                    (datumPocetka.dirty || datumPocetka.touched)
                  "
                  class="invalid-feedback"
                >
                  <div *ngIf="datumPocetka.errors.required">
                    Datum početka kursa je obavezan
                  </div>
                </div>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="brojPolaznika">Broj Polaznika</label>
                <input
                  [ngClass]="{
                    'is-invalid':
                      brojPolaznika.invalid &&
                      (brojPolaznika.dirty || brojPolaznika.touched)
                  }"
                  required
                  type="number"
                  class="form-control"
                  id="brojPolaznika"
                  pattern="^[1-9]{1}$|^[1-4]{1}[0-9]{1}$|^50$"
                  name="brojPolaznika"
                  #brojPolaznika="ngModel"
                  [(ngModel)]="kurs.brojPolaznika"
                />
                <div
                  *ngIf="
                    brojPolaznika.invalid &&
                    (brojPolaznika.dirty || brojPolaznika.touched)
                  "
                  class="invalid-feedback"
                >
                  <div *ngIf="brojPolaznika.errors.required">
                    Broj polaznika obuke je obavezan
                  </div>
                </div>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="naziv">Cijena u KM</label>
                <input
                  [ngClass]="{
                    'is-invalid':
                      cijena.invalid && (cijena.dirty || cijena.touched)
                  }"
                  required
                  type="text"
                  class="form-control"
                  id="cijena"
                  placeholder="Cijena"
                  name="cijena"
                  #cijena="ngModel"
                  [(ngModel)]="kurs.cijena"
                />
                <div
                  *ngIf="cijena.invalid && (cijena.dirty || cijena.touched)"
                  class="invalid-feedback"
                >
                  <div *ngIf="naziv.errors.required">
                    Cijena kursa je obavezna
                  </div>
                </div>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="trajanje">Trajanje kursa u sedmicama</label>
                <input
                  [ngClass]="{
                    'is-invalid':
                      trajanje.invalid && (trajanje.dirty || trajanje.touched)
                  }"
                  required
                  type="number"
                  class="form-control"
                  id="trajanje"
                  name="trajanje"
                  #trajanje="ngModel"
                  [(ngModel)]="kurs.trajanje"
                />
                <div
                  *ngIf="
                    trajanje.invalid && (trajanje.dirty || trajanje.touched)
                  "
                  class="invalid-feedback"
                >
                  <div *ngIf="trajanje.errors.required">
                    Trajanje obuke je obavezno
                  </div>
                </div>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="kratakOpis">Kratak opis</label>
                <input
                  [ngClass]="{
                    'is-invalid':
                    kratakOpis.invalid && (kratakOpis.dirty || kratakOpis.touched)
                  }"
                  required
                  type="text"
                  class="form-control"
                  id="kratakOpis"
                  placeholder="Kratak Opis"
                  name="kratakOpis"
                  #kratakOpis="ngModel"
                  [(ngModel)]="kurs.kratakOpis"
                />
                <div
                  *ngIf="kratakOpis.invalid && (kratakOpis.dirty || kratakOpis.touched)"
                  class="invalid-feedback"
                >
                  <div *ngIf="kratakOpis.errors.required">
                    Kratak opis kursa je obavezan
                  </div>
                </div>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="opis">Opis</label>
                <ejs-richtexteditor
                  id="iframeRTE"
                  [toolbarSettings]="tools"
                  [iframeSettings]="iframe"
                  [enableResize]='true'
                  [fontFamily]='fontFamily'
                  [fontSize]='fontSize'
                  [format]='format'
                  [formatter]='formatter'
                  [enabled]='true'
                  [insertImageSettings]='insertImageSettings' 
                  [height]="auto"
                  required
                  #opis="ngModel"
                  id="opis"
                  [(ngModel)]="kurs.opis"
                  name="opis"
                >
                  <ng-template #valueTemplate>
                    <p></p>
                  </ng-template>
                </ejs-richtexteditor>
              </div>
            </div>
          </div>
          <div class="row" *ngIf="kurs.imageUrl != ''">
            <label>Slika</label>
            <div class="col-3">
              <div class="card">
                <img
                  class="card-img-top"
                  width="100%"
                  height="225"
                  src="{{ kurs.imageUrl }}"
                />
                <div class="btn-group" style="width: 100%"></div>
              </div>
            </div>
          </div>
          <ng-container>
            <div class="progress form-group" *ngIf="progress > 0">
              <div
                class="progress-bar progress-bar-striped bg-success"
                role="progressbar"
                [style.width.%]="progress"
              >
                {{ progress }}%
              </div>
            </div>
            <div class="d-flex justify-content-between my-3">
              <h3>Dodaj novu sliku</h3>
            </div>
            <div class="row">
              <div class="col-4">
                <h3>Korak 1 - Odaberi sliku</h3>
                <div
                  class="custom-dropzone"
                  ngx-dropzone
                  (change)="onSelect($event)"
                >
                  <ngx-dropzone-label>
                    <i class="fa fa-upload fa-4x"></i>
                    <h4>Prevuci sliku ovdje</h4>
                  </ngx-dropzone-label>
                </div>
              </div>
              <div class="col-4 img-preview" *ngIf="files[0]">
                <h3>Korak 3 - Izmjeni velicinu slike</h3>
                <image-cropper
                  class="img-fluid"
                  [imageChangedEvent]="imageChangedEvent"
                  [imageFile]="files[0]"
                  [maintainAspectRatio]="false"
                  [aspectRatio]="1"
                  format="png"
                  (imageCropped)="imageCropped($event)"
                ></image-cropper>
              </div>
              <div class="col-4" *ngIf="files[0]">
                <h3>Korak 3 - Pregled Slike</h3>
                <ng-container *ngIf="croppedImage">
                  <img [src]="croppedImage" class="img-fluid" />
                </ng-container>
              </div>
            </div>
          </ng-container>
          <button
            [disabled]="!kursForm.valid"
            type="submit"
            class="btn btn-primary my-3 float-right"
          >
            Spremi
          </button>
        </form>
      </div>
    </div>
  </div>
</section>
